# Контекст та змінні

Система Context надає вирішення змінних під час виконання для вашої конфігурації, забезпечуючи динамічну конфігурацію на основі оточення, введення користувача або інших значень під час виконання.

## Огляд

Context - це сховище ключ-значення, на яке можуть посилатися значення конфігурації під час парсингу. Він забезпечує:

- Вирішення змінних оточення
- Динамічне впровадження значень
- Конфігурація під час виконання
- Багатоорендні конфігурації
- Прапорці функцій на основі стану під час виконання

## Основи контексту

### Створення контексту

```php
use Concept\Config\Context\Context;

// Порожній контекст
$context = new Context();

// З початковими даними
$context = new Context([
    'environment' => 'production',
    'region' => 'us-east-1',
    'tenant' => 'acme-corp'
]);
```

### Додавання до Config

```php
use Concept\Config\Config;

// Під час створення
$config = new Config(
    data: ['key' => 'value'],
    context: ['env' => 'production']
);

// Після створення
$config->withContext([
    'environment' => 'staging',
    'debug' => true
]);
```

## Змінні оточення

### Додавання змінних оточення

```php
$context = new Context();

// Додати всі змінні оточення
$context->withEnv(getenv());

// Або конкретні змінні
$context->withEnv([
    'DB_HOST' => getenv('DB_HOST'),
    'DB_PORT' => getenv('DB_PORT'),
]);
```

### Використання в конфігурації

```php
$config = new Config([
    'database' => [
        'host' => '@env(DB_HOST)',
        'port' => '@env(DB_PORT)',
        'user' => '@env(DB_USER)',
        'password' => '@env(DB_PASSWORD)',
    ]
]);

// Додати контекст оточення
$config->getContext()->withEnv(getenv());

// Парсинг для вирішення
$config->getParser()->parse($config->dataReference());

echo $config->get('database.host'); // Значення з змінної оточення DB_HOST
```

## Користувацькі секції

Організація контекстних даних в логічні секції:

```php
$context = $config->getContext();

// Додати секцію бази даних
$context->withSection('database', [
    'default' => 'mysql',
    'connections' => ['mysql', 'pgsql']
]);

// Додати секцію кешу
$context->withSection('cache', [
    'driver' => 'redis',
    'prefix' => 'app_'
]);
```

## Вирішення змінних

Система конфігурації підтримує чотири типи вирішення змінних:

| Тип | Синтаксис | Призначення | Приклад |
|------|--------|---------|---------|
| Змінні оточення | `@env(VAR)` | Доступ до системних змінних оточення | `@env(DB_HOST)` |
| Контекстні змінні | `\${var}` | Доступ до контекстних даних | `\${region}` |
| Посилання на вузли | `#path` | Посилання на цілі вузли конфігурації | `#database.config` |
| Інтерполяція значень | `#{path}` | Інтерполяція значень у рядках | `http://#{host}:#{port}` |

## Практичні приклади

Див. повну документацію для детальних прикладів багатосередовищних та багатоорендних конфігурацій.

## Найкращі практики

### 1. Чітке розділення контексту

```php
// Добре: Організувати контекст в логічні секції
$context->withSection('app', [...]);
$context->withSection('user', [...]);
```

### 2. Використання значень за замовчуванням

```php
// Добре: Завжди надавати розумні значення за замовчуванням
'timeout' => '\${api.timeout|30}'
```
